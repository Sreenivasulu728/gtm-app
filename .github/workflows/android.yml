name: Build Android APK

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v4

    - name: Install Ubuntu dependencies
      run: |
        # OpenJDK 17 is required by the Android build tools
        sudo apt update
        sudo apt install "-y" python3-pip python3-setuptools git zip openjdk-17-jdk unzip wget libpython3-dev

    - name: Install Buildozer + Cython
      run: |
        # Install buildozer and cython to user path
        pip install --user buildozer cython
        # Add user's local bin to the PATH for subsequent steps
        echo "$HOME/.local/bin" >> $GITHUB_PATH

    - name: Build APK (Automatic Dependencies)
      # Set necessary environment variables for buildozer
      env:
        # Define JAVA_HOME explicitly for the build process
        JAVA_HOME: /usr/lib/jvm/java-17-openjdk-amd64
        # Telling buildozer to accept licenses automatically for all downloads
        ANDROID_SDK_ACCEPT_LICENSES: yes
      run: |
        # Buildozer will automatically check for missing SDK/NDK/ANT
        # and download them into its standard paths if not found.
        # This resolves the "sdkmanager not found" error.
        buildozer android debug
